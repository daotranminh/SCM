{% extends 'layout.html' %}

{% block body %}

{% from "includes/_formhelpers.html" import render_field %}

<h1>Update order</h1>

    <form method="POST" action="">
      <input type="hidden" id="order_id" value="{{order_id}}" display="none" disabled/>

      <div class="form-group">
            <label for="customer_id">Customer</label>
            <select id="customer_id" name="customer_id">
              {% for customer_rec in customer_recs %}
                {% if customer_rec.id == customer_id %}
                  <option value="{{customer_rec.id}}" selected>{{customer_rec.name}}</option>
                {% else %}
                  <option value="{{customer_rec.id}}">{{customer_rec.name}}</option>
                {% endif %}
              {% endfor %}
            </select>
      </div>

      <div class="form-group">
            <label for="ordered_on">Ordered on</label>
            <input type="text" name="ordered_on" id="ordered_on" value="{{ordered_on}}">
      </div>

      <div class="form-group">
            <label for="delivery_appointment">Delivery appointment</label>
            <input type="text" name="delivery_appointment" id="delivery_appointment" value="{{delivery_appointment}}">
      </div>

      <div class="form-group">
            <label for="delivery_method_id">Delivery method</label>
            <select id="delivery_method_id" name="delivery_method_id">
              {% for delivery_method_rec in delivery_method_recs %}
                {% if delivery_method_rec.id == delivery_method_id %}
                <option value="{{delivery_method_rec.id}}" selected>{{delivery_method_rec.name}}</option>
                {% else %}
                <option value="{{delivery_method_rec.id}}">{{delivery_method_rec.name}}</option>
                {% endif %}
              {% endfor %}
            </select>
      </div>

      <div class="form-group">
            <label for="order_status">Order status</label>
            <select id="order_status" name="order_status">
              {% for order_status_name in order_status_names %}
                {% if order_status_name[0] == order_status %}
                <option value="{{order_status_name[0]}}" selected>{{order_status_name[1]}}</option>
                {% else %}
                <option value="{{order_status_name[0]}}">{{order_status_name[1]}}</option>
                {% endif %}
              {% endfor %}
            </select>
      </div>

      <div class="form-group">
            <label for="delivered_on">Delivered on</label>
            <input type="text" name="delivered_on" id="delivered_on" value="{{delivered_on}}">
      </div>

      <div class="form-group">
            <label for="payment_status">Payment status</label>
            <select id="payment_status" name="payment_status">
              {% for payment_status_name in payment_status_names %}
                {% if payment_status_name[0] == payment_status %}
                <option value="{{payment_status_name[0]}}" selected>{{payment_status_name[1]}}</option>
                {% else %}
                <option value="{{payment_status_name[0]}}">{{payment_status_name[1]}}</option>
                {% endif %}
              {% endfor %}
            </select>
      </div>

      <div class="form-group">
            <label for="paid_on">Paid on</label>
            <input type="text" name="paid_on" id="paid_on" value="{{paid_on}}">
      </div>

      <table class="table table-striped">
            <thead>
              <tr>
                <th>Product Id</th>
                <th>Product Name</th>
                <th>Taste</th>
                <th>Decoration Form</th>
                <th>Decoration Technique</th>
                <th>Formula</th>
                <th>Sample Images</th>
                <th>Cost Estimation per Product</th>
                <th>Amount</th>
                <th>Cost estimation</th>
                <th></th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for product_dto in product_dtos %}
              <tr>
                <td>{{product_dto.product_id}}</td>
                <td><a href="{{ url_for('product_details', product_id=product_dto.product_id) }}">{{product_dto.product_name}}</a></td>
                <td>{{product_dto.taste_name}}</td>
                <td>{{product_dto.decoration_form_name}}</td>
                <td>{{product_dto.decoration_technique_name}}</td>
                
                {% if product_dto.formula_id is not none %}
                  <td><a href="{{ url_for('formula_details', formula_id=product_dto.formula_id) }}">{{product_dto.formula_name}}</a></td>
                {% else %}
                  <td>{{product_dto.formula_name}}</td>
                {% endif %}
      
                {% if product_dto.sample_images_group_id is not none %}
                  <td><a href="{{ url_for('sample_images_group_details', sample_images_group_id=product_dto.sample_images_group_id) }}">{{product_dto.sample_images_group_name}}</a></td>
                {% else %}
                  <td>{{product_dto.sample_images_group_name}}</td>
                {% endif %}

                <td>{{product_dto.product_cost_estimation}}</td>

                <td>{{product_dto.product_amount}}</td>
      
                {% if product_dto.product_cost_estimation is not none %}
                  <td>{{product_dto.product_cost_estimation * product_dto.product_amount }}</td>
                {% else %}
                  <td>{{product_dto.product_cost_estimation}}</td>
                {% endif %}

                <td><a href="{{ url_for('update_product', product_id=product_dto.product_id) }}"
                       class="btn btn-default pullright">Update</a></td></td>
                <td><a href="{{ url_for('delete_product', product_id=product_dto.product_id) }}"
                       class="btn btn-default pullright">Delete</a></td></td>
              </tr>
              {% endfor %}
              <tr>
                <td>Total cost</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>{{ order_cost_estimation }}</td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
          </table>

      <div class="form-group">
        <p><label>Additional product:</label></p>
        <p>
          <label for="new_product_name">Name</label>
          <input type="text" id="new_product_name" name="new_product_name"/>
        </p>

        <p>
          <label for="taste_id">Taste</label>
          <select id="taste_id" name="taste_id">
	        {% for taste_rec in taste_recs %}
	          <option value="{{taste_rec.id}}">{{taste_rec.name}}</option>
	        {% endfor %}
          </select>
        </p>
            
        <p>
          <label for="decoration_form_id">Decoration form</label>
          <select id="decoration_form_id" name="decoration_form_id">
	        {% for decoration_form_rec in decoration_form_recs %}
	          <option value="{{decoration_form_rec.id}}">{{decoration_form_rec.name}}</option>
	        {% endfor %}
          </select>
        </p>
    
        <p>
          <label for="decoration_technique_id">Decoration technique</label>
          <select id="decoration_technique_id" name="decoration_technique_id">
	        {% for decoration_technique_rec in decoration_technique_recs %}
	          <option value="{{decoration_technique_rec.id}}">{{decoration_technique_rec.name}}</option>
	        {% endfor %}
          </select>
        </p>

        <p>
          <label for="with_box">With box</label><br>
          <input type="checkbox" id="with_box" name="with_box">
        </p>
      </div>

      <br/>
      <p><button type="button" 
            class="btn btn-default pullright" 
            onclick="add_new_product_to_order();">Add product to order</button></p>

      <div class="form-group">
	      <label for="message">Message</label>
            <textarea class="form-control" cols="80" id="message" name="message" rows="10">{{message}}</textarea>
      </div>
      
      <p><input type="submit" class="btn btn-primary" value="Submit"/></p>
    </form>

<script>
  $('#delivery_method_id').select2();
  $('#customer_id').select2();
  $('#taste_id').select2();
  $('#decoration_form_id').select2();
  $('#decoration_technique_id').select2();
  $('*[name=ordered_on]').appendDtpicker();
  $('*[name=delivery_appointment]').appendDtpicker();
  $('*[name=delivered_on]').appendDtpicker();
  $('*[name=paid_on]').appendDtpicker();
</script>

{% endblock %}
